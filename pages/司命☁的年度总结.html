<!DOCTYPE html>
<html>
<head>
    <title>司命☁的年度总结</title>
    <meta charset="utf-8">

    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .card {
            background: rgb(255, 255, 255);
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); 
            padding: 20px;
            margin: 20px 0;
            border: 1px solid #ccc;
        }
        .summary-item {
            margin: 20px 0;
        }
        .flex-container {
            display: flex;
            gap: 40px;
            margin: 20px 0;
        }
        .flex-column {
            flex: 1;
        }
        .chart-container {
            position: relative;
            height: 300px;
            width: 100%;
            margin: 20px 0;
        }
        .monthly-stats {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 10px;
            margin: 10px 0;
        }
        .month-stat {
            padding: 10px;
            border: 1px solid #ddd;
            text-align: center;
        }
        .tag {
            display: inline-block;
            padding: 4px 8px;
            margin: 4px;
            border-radius: 4px;
            background-color: #e9ecef;
            color: #495057;
        }
        .tag.active {
            background-color: #007bff;
            color: white;
        }
        .confidence {
            font-size: 0.9em;
            color: #6c757d;
        }
        .confidence.high {
            color: #28a745;
        }
        .confidence.medium {
            color: #ffc107;
        }
        .confidence.low {
            color: #dc3545;
        }
        .heatmap-container {
            display: grid;
            grid-template-columns: repeat(24, 1fr);
            gap: 2px;
            margin: 20px 0;
        }
        .heatmap-cell {
            aspect-ratio: 1;
            border-radius: 2px;
        }
        .back-button {
            display: inline-block;
            padding: 10px 20px;
            background-color: #007bff;
            border: none;
            border-radius: 4px;
            text-decoration: none;
            color: white;
            margin-bottom: 20px;
            transition: background-color 0.3s;
        }
        .back-button:hover {
            background-color: #0056b3;
        }
        .stat-card {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .stat-value {
            font-size: 1.5em;
            font-weight: bold;
            color: #007bff;
        }
        .tags-section {
            margin: 10px 0;
        }
        .tags-section h4 {
            margin: 15px 0 8px 0;
            color: #495057;
            font-size: 0.95em;
        }
        .tags-container {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            padding: 5px 0;
        }
        .tag {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 16px;
            font-size: 0.9em;
            margin: 0;
        }
        .tag.primary {
            background-color: #007bff;
            color: white;
        }
        .tag.secondary {
            background-color: #28a745;
            color: white;
        }
        .tag.special {
            background-color: #17a2b8;
            color: white;
        }
        .tag.rank {
            background-color: #ffd700;
            color: #000;
            font-weight: bold;
            font-size: 0.85em;
            padding: 2px 8px;
            margin-left: 8px;
            vertical-align: middle;
        }
    </style>
</head>
<body>
    <a href="../index.html" class="back-button">返回首页</a>
    <div class="card">
        <h1>司命☁的年度总结</h1>
        
        <div class="card">
            <div class="flex-container">
                <div class="flex-column">
                    <div class="summary-item">
                        <h3>首次进楼时间</h3>
                        <p class="stat-value">2024年08月19日 23:03:47</p>
                    </div>
                    
                    <div class="summary-item">
                        <h3>年度盖楼总次数</h3>
                        <p class="stat-value">5108次</p>
                    </div>
                    
                    <div class="summary-item">
                        <h3>最活跃的一天</h3>
                        <p class="stat-value">2024年10月26日: 113条发言</p>
                    </div>
                </div>
                    
                <div class="flex-column">
                    <div class="summary-item">
                        <h3>活跃度分析</h3>
                        <p>活跃天数：<span class="stat-value">129</span> / 130 天
                        
                            <span class="tag rank">Top50</span>
                        
                        </p>
                        
                        <div class="tags-container">
                            
                                
                                    <span class="tag primary">夜间活跃</span>
                                
                            
                                
                                    <span class="tag primary">下午活跃</span>
                                
                            
                                
                            
                                
                            
                        </div>
                        
                        <p>最长持续在线：<span class="stat-value">123</span> 天
                        
                            <span class="tag rank">Top3</span>
                        
                        </p>
                        
                            <span class="tag special">连续活跃</span>
                        
                        
                        <p>活跃时平均每天盖楼：<span class="stat-value">39.6</span> 条
                        
                            <span class="tag rank">Top30</span>
                        
                        </p>
                    </div>
                </div>
            </div>
        </div>


        <div class="card">
            <div class="flex-container">
                <div class="flex-column">
                    
                    <div class="summary-item">
                        <h3>回复最多的用户</h3>
                        <p class="stat-value">虎mo</p>
                        <p>共回复320次</p>
                    </div>
                    
                </div>
                
                <div class="flex-column">
                    
                    <div class="summary-item">
                        <h3>被回复最多的用户</h3>
                        <p class="stat-value">六扇门内李银心</p>
                        <p>被回复318次</p>
                    </div>
                    
                </div>
            </div>
        </div>
    
        <div class="card">
            <h3>每日盖楼热力趋势</h3>
            <div class="chart-container">
                <canvas id="hourlyHeatmap"></canvas>
            </div>
        </div>

        <div class="card">
            <h3>添砖加瓦趋势</h3>
            <div class="chart-container">
                <canvas id="monthlyChart"></canvas>
            </div>
        </div>

        <!-- 使用 Chart.js -->
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
        
        <script type="text/javascript">
            var monthlyChart = null;
            var hourlyChart = null;
            
            // 确保DOM加载完成后初始化图表
            document.addEventListener('DOMContentLoaded', function() {
                console.log('DOM加载完成');
                initializeCharts();
            });
            
            function initializeCharts() {
                try {
                    // 月度趋势图
                    var monthlyData = [{"count": 591, "month": "2024-08"}, {"count": 1215, "month": "2024-09"}, {"count": 1142, "month": "2024-10"}, {"count": 1340, "month": "2024-11"}, {"count": 820, "month": "2024-12"}];
                    var monthlyCtx = document.getElementById('monthlyChart');
                    if (monthlyCtx) {
                        // 如果已存在图表实例，先销毁
                        if (monthlyChart) {
                            monthlyChart.destroy();
                            monthlyChart = null;
                        }
                        
                        monthlyChart = new Chart(monthlyCtx.getContext('2d'), {
                            type: 'bar',
                            data: {
                                labels: monthlyData.map(function(item) { return item.month; }),
                                datasets: [{
                                    label: '盖楼数',
                                    data: monthlyData.map(function(item) { return item.count; }),
                                    backgroundColor: 'rgba(54, 162, 235, 0.5)',
                                    borderColor: 'rgba(54, 162, 235, 1)',
                                    borderWidth: 1
                                }]
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                scales: {
                                    y: {
                                        beginAtZero: true
                                    }
                                }
                            }
                        });
                    }
                    
                    // 小时分布热力图
                    var hourlyData = {"0": 413, "1": 101, "2": 17, "3": 8, "4": 7, "5": 4, "6": 5, "7": 9, "8": 18, "9": 126, "10": 213, "11": 277, "12": 310, "13": 238, "14": 236, "15": 253, "16": 268, "17": 284, "18": 322, "19": 421, "20": 324, "21": 376, "22": 411, "23": 467};
                    var hourlyCtx = document.getElementById('hourlyHeatmap');
                    if (hourlyCtx) {
                        // 如果已存在图表实例，先销毁
                        if (hourlyChart) {
                            hourlyChart.destroy();
                            hourlyChart = null;
                        }
                        
                        var hours = Array.from({length: 24}, function(_, i) { return i; });
                        var hourCounts = hours.map(function(hour) { 
                            return hourlyData[hour] || 0; 
                        });
                        
                        hourlyChart = new Chart(hourlyCtx.getContext('2d'), {
                            type: 'bar',
                            data: {
                                labels: hours.map(function(h) { return h + '时'; }),
                                datasets: [{
                                    label: '盖楼数',
                                    data: hourCounts,
                                    backgroundColor: hourCounts.map(function(count) {
                                        var maxCount = Math.max.apply(null, hourCounts);
                                        var alpha = Math.min(count / maxCount, 1);
                                        return 'rgba(54, 162, 235, ' + alpha + ')';
                                    }),
                                    borderColor: 'rgba(54, 162, 235, 1)',
                                    borderWidth: 1
                                }]
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                scales: {
                                    y: {
                                        beginAtZero: true
                                    }
                                }
                            }
                        });
                    }
                } catch (error) {
                    console.error('初始化图表时出错:', error);
                    console.error('错误堆栈:', error.stack);
                }
            }
        </script>
        
        
        <div class="card">
            <div class="card-header">
                <h5>旅行足迹</h5>
            </div>
            <div class="card-body">
                <div id="travel-heatmap" style="width: 100%; height: 600px; margin: 20px 0;"></div>
            </div>
        </div>
        
        <!-- 使用 ECharts -->
        <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
        
        <script type="text/javascript">
            var mapChart = null;
            
            document.addEventListener('DOMContentLoaded', async function() {
                await initializeMap();
            });
            
            async function initializeMap() {
                try {
                    // 初始化旅行热力图
                    var travelData = [{"first_time": "2024-08-19 23:03:47", "last_time": "2024-12-21 14:40:11", "location": "\u5317\u4eac", "post_count": 3470, "stay_days": 57.1, "visits": ["2024-08-19 23:03 - 2024-08-20 10:45 (23\u6761\u53d1\u8a00)", "2024-08-20 11:27 - 2024-08-20 22:51 (24\u6761\u53d1\u8a00)", "2024-08-21 11:37 - 2024-08-21 23:27 (25\u6761\u53d1\u8a00)", "2024-08-21 23:46 - 2024-08-22 10:21 (2\u6761\u53d1\u8a00)", "2024-08-22 13:08 - 2024-08-23 00:42 (63\u6761\u53d1\u8a00)", "2024-08-23 13:43 - 2024-08-24 01:00 (59\u6761\u53d1\u8a00)", "2024-08-24 10:58 - 2024-08-24 21:51 (15\u6761\u53d1\u8a00)", "2024-08-24 23:13 - 2024-08-25 02:18 (41\u6761\u53d1\u8a00)", "2024-08-25 12:58 - 2024-08-26 00:57 (34\u6761\u53d1\u8a00)", "2024-08-26 01:02 - 2024-08-26 12:20 (18\u6761\u53d1\u8a00)", "2024-08-26 13:08 - 2024-08-27 00:13 (68\u6761\u53d1\u8a00)", "2024-08-27 12:59 - 2024-08-28 00:56 (54\u6761\u53d1\u8a00)", "2024-08-28 10:48 - 2024-08-28 16:27 (14\u6761\u53d1\u8a00)", "2024-08-31 14:14 - 2024-08-31 23:27 (35\u6761\u53d1\u8a00)", "2024-09-01 11:53 - 2024-09-01 18:31 (6\u6761\u53d1\u8a00)", "2024-09-02 00:45 - 2024-09-02 09:47 (16\u6761\u53d1\u8a00)", "2024-09-02 12:19 - 2024-09-02 22:45 (17\u6761\u53d1\u8a00)", "2024-09-03 00:22 - 2024-09-03 11:21 (1\u6761\u53d1\u8a00)", "2024-09-04 12:37 - 2024-09-05 00:26 (63\u6761\u53d1\u8a00)", "2024-09-05 00:38 - 2024-09-05 12:35 (23\u6761\u53d1\u8a00)", "2024-09-05 14:40 - 2024-09-06 00:02 (45\u6761\u53d1\u8a00)", "2024-09-06 11:09 - 2024-09-06 22:51 (48\u6761\u53d1\u8a00)", "2024-09-06 23:41 - 2024-09-07 03:01 (17\u6761\u53d1\u8a00)", "2024-09-07 12:37 - 2024-09-07 19:32 (33\u6761\u53d1\u8a00)", "2024-09-08 00:50 - 2024-09-08 10:12 (7\u6761\u53d1\u8a00)", "2024-09-08 13:05 - 2024-09-09 00:30 (36\u6761\u53d1\u8a00)", "2024-09-09 08:49 - 2024-09-09 19:58 (31\u6761\u53d1\u8a00)", "2024-09-11 15:35 - 2024-09-11 22:32 (6\u6761\u53d1\u8a00)", "2024-09-12 12:21 - 2024-09-13 00:17 (19\u6761\u53d1\u8a00)", "2024-09-13 00:27 - 2024-09-13 10:47 (7\u6761\u53d1\u8a00)", "2024-09-13 16:07 - 2024-09-13 23:44 (21\u6761\u53d1\u8a00)", "2024-09-14 09:42 - 2024-09-14 15:36 (7\u6761\u53d1\u8a00)", "2024-09-22 18:46 - 2024-09-23 01:47 (24\u6761\u53d1\u8a00)", "2024-09-23 09:39 - 2024-09-23 21:32 (38\u6761\u53d1\u8a00)", "2024-09-23 21:48 - 2024-09-24 09:32 (15\u6761\u53d1\u8a00)", "2024-09-24 14:27 - 2024-09-25 00:37 (19\u6761\u53d1\u8a00)", "2024-09-25 09:03 - 2024-09-25 14:39 (15\u6761\u53d1\u8a00)", "2024-09-28 11:23 - 2024-09-28 23:22 (23\u6761\u53d1\u8a00)", "2024-09-28 23:30 - 2024-09-29 10:46 (15\u6761\u53d1\u8a00)", "2024-09-29 13:23 - 2024-09-29 23:52 (15\u6761\u53d1\u8a00)", "2024-09-30 12:03 - 2024-09-30 12:06 (2\u6761\u53d1\u8a00)", "2024-10-01 00:55 - 2024-10-01 13:00 (11\u6761\u53d1\u8a00)", "2024-10-01 20:15 - 2024-10-02 01:01 (9\u6761\u53d1\u8a00)", "2024-10-02 10:37 - 2024-10-02 18:34 (7\u6761\u53d1\u8a00)", "2024-10-03 02:06 - 2024-10-03 10:34 (3\u6761\u53d1\u8a00)", "2024-10-03 19:35 - 2024-10-04 07:19 (7\u6761\u53d1\u8a00)", "2024-10-04 12:49 - 2024-10-05 00:48 (83\u6761\u53d1\u8a00)", "2024-10-05 01:02 - 2024-10-05 12:27 (18\u6761\u53d1\u8a00)", "2024-10-05 13:46 - 2024-10-06 01:09 (34\u6761\u53d1\u8a00)", "2024-10-06 09:57 - 2024-10-06 21:40 (48\u6761\u53d1\u8a00)", "2024-10-06 22:04 - 2024-10-07 01:40 (26\u6761\u53d1\u8a00)", "2024-10-07 15:03 - 2024-10-08 00:06 (38\u6761\u53d1\u8a00)", "2024-10-08 09:44 - 2024-10-08 21:08 (46\u6761\u53d1\u8a00)", "2024-10-08 22:02 - 2024-10-09 08:53 (13\u6761\u53d1\u8a00)", "2024-10-09 10:16 - 2024-10-09 14:29 (6\u6761\u53d1\u8a00)", "2024-10-10 15:23 - 2024-10-10 22:44 (43\u6761\u53d1\u8a00)", "2024-10-11 10:20 - 2024-10-11 22:06 (40\u6761\u53d1\u8a00)", "2024-10-11 22:24 - 2024-10-11 23:29 (4\u6761\u53d1\u8a00)", "2024-10-12 12:11 - 2024-10-12 23:44 (23\u6761\u53d1\u8a00)", "2024-10-13 11:09 - 2024-10-13 21:14 (14\u6761\u53d1\u8a00)", "2024-10-13 23:25 - 2024-10-14 11:20 (7\u6761\u53d1\u8a00)", "2024-10-14 11:27 - 2024-10-14 22:42 (19\u6761\u53d1\u8a00)", "2024-10-14 23:51 - 2024-10-15 10:46 (34\u6761\u53d1\u8a00)", "2024-10-15 12:46 - 2024-10-15 22:40 (22\u6761\u53d1\u8a00)", "2024-10-16 01:31 - 2024-10-16 11:20 (4\u6761\u53d1\u8a00)", "2024-10-16 14:43 - 2024-10-17 00:29 (22\u6761\u53d1\u8a00)", "2024-10-17 10:18 - 2024-10-17 22:15 (9\u6761\u53d1\u8a00)", "2024-10-17 23:44 - 2024-10-18 12:02 (4\u6761\u53d1\u8a00)", "2024-10-19 16:48 - 2024-10-19 23:48 (38\u6761\u53d1\u8a00)", "2024-10-20 11:41 - 2024-10-20 22:37 (26\u6761\u53d1\u8a00)", "2024-10-21 01:44 - 2024-10-21 13:41 (24\u6761\u53d1\u8a00)", "2024-10-21 13:46 - 2024-10-21 22:56 (21\u6761\u53d1\u8a00)", "2024-10-22 13:15 - 2024-10-23 00:21 (6\u6761\u53d1\u8a00)", "2024-10-23 10:48 - 2024-10-23 13:57 (7\u6761\u53d1\u8a00)", "2024-10-24 17:38 - 2024-10-25 02:11 (9\u6761\u53d1\u8a00)", "2024-10-25 16:27 - 2024-10-26 01:16 (24\u6761\u53d1\u8a00)", "2024-10-26 10:23 - 2024-10-26 22:21 (80\u6761\u53d1\u8a00)", "2024-10-26 22:27 - 2024-10-27 03:16 (32\u6761\u53d1\u8a00)", "2024-10-27 12:02 - 2024-10-28 00:02 (15\u6761\u53d1\u8a00)", "2024-10-28 00:07 - 2024-10-28 11:48 (17\u6761\u53d1\u8a00)", "2024-10-28 13:05 - 2024-10-29 00:49 (13\u6761\u53d1\u8a00)", "2024-10-29 12:17 - 2024-10-29 23:40 (27\u6761\u53d1\u8a00)", "2024-10-30 00:24 - 2024-10-30 00:36 (4\u6761\u53d1\u8a00)", "2024-10-30 19:31 - 2024-10-31 00:23 (20\u6761\u53d1\u8a00)", "2024-10-31 15:12 - 2024-10-31 23:14 (11\u6761\u53d1\u8a00)", "2024-11-01 12:47 - 2024-11-02 00:00 (9\u6761\u53d1\u8a00)", "2024-11-02 12:38 - 2024-11-02 18:36 (28\u6761\u53d1\u8a00)", "2024-11-03 16:47 - 2024-11-03 22:43 (24\u6761\u53d1\u8a00)", "2024-11-04 09:15 - 2024-11-04 13:43 (3\u6761\u53d1\u8a00)", "2024-11-04 18:30 - 2024-11-05 00:32 (14\u6761\u53d1\u8a00)", "2024-11-05 10:46 - 2024-11-05 21:19 (4\u6761\u53d1\u8a00)", "2024-11-06 00:11 - 2024-11-05 21:19 (1\u6761\u53d1\u8a00)", "2024-11-06 16:47 - 2024-11-07 12:33 (7\u6761\u53d1\u8a00)", "2024-11-09 16:26 - 2024-11-09 23:53 (33\u6761\u53d1\u8a00)", "2024-11-10 11:18 - 2024-11-10 22:55 (55\u6761\u53d1\u8a00)", "2024-11-11 00:10 - 2024-11-11 11:21 (29\u6761\u53d1\u8a00)", "2024-11-11 12:32 - 2024-11-12 00:02 (75\u6761\u53d1\u8a00)", "2024-11-12 01:20 - 2024-11-12 12:59 (5\u6761\u53d1\u8a00)", "2024-11-12 13:52 - 2024-11-13 01:41 (51\u6761\u53d1\u8a00)", "2024-11-13 04:09 - 2024-11-13 16:09 (31\u6761\u53d1\u8a00)", "2024-11-17 17:23 - 2024-11-17 21:51 (10\u6761\u53d1\u8a00)", "2024-11-18 18:20 - 2024-11-18 22:56 (40\u6761\u53d1\u8a00)", "2024-11-19 10:41 - 2024-11-19 18:23 (6\u6761\u53d1\u8a00)", "2024-11-19 23:12 - 2024-11-19 23:27 (2\u6761\u53d1\u8a00)", "2024-11-20 11:20 - 2024-11-20 23:19 (42\u6761\u53d1\u8a00)", "2024-11-21 11:02 - 2024-11-21 22:58 (70\u6761\u53d1\u8a00)", "2024-11-21 23:07 - 2024-11-21 23:33 (6\u6761\u53d1\u8a00)", "2024-11-22 12:53 - 2024-11-22 22:55 (41\u6761\u53d1\u8a00)", "2024-11-23 19:30 - 2024-11-24 01:45 (22\u6761\u53d1\u8a00)", "2024-11-24 12:10 - 2024-11-24 23:39 (36\u6761\u53d1\u8a00)", "2024-11-25 00:30 - 2024-11-25 12:04 (32\u6761\u53d1\u8a00)", "2024-11-25 13:03 - 2024-11-26 00:31 (18\u6761\u53d1\u8a00)", "2024-11-26 11:27 - 2024-11-26 22:48 (50\u6761\u53d1\u8a00)", "2024-11-26 23:39 - 2024-11-27 09:41 (9\u6761\u53d1\u8a00)", "2024-11-27 12:04 - 2024-11-28 00:02 (23\u6761\u53d1\u8a00)", "2024-11-28 00:23 - 2024-11-28 11:56 (20\u6761\u53d1\u8a00)", "2024-11-28 12:47 - 2024-11-28 23:34 (30\u6761\u53d1\u8a00)", "2024-11-29 10:56 - 2024-11-29 22:50 (21\u6761\u53d1\u8a00)", "2024-11-30 00:36 - 2024-11-30 10:51 (3\u6761\u53d1\u8a00)", "2024-11-30 17:19 - 2024-12-01 00:25 (19\u6761\u53d1\u8a00)", "2024-12-01 12:51 - 2024-12-02 00:29 (12\u6761\u53d1\u8a00)", "2024-12-02 01:05 - 2024-12-02 10:50 (13\u6761\u53d1\u8a00)", "2024-12-02 22:38 - 2024-12-03 00:48 (15\u6761\u53d1\u8a00)", "2024-12-03 12:11 - 2024-12-03 23:09 (10\u6761\u53d1\u8a00)", "2024-12-04 00:16 - 2024-12-04 00:43 (3\u6761\u53d1\u8a00)", "2024-12-04 13:01 - 2024-12-05 00:32 (66\u6761\u53d1\u8a00)", "2024-12-05 04:59 - 2024-12-05 10:53 (7\u6761\u53d1\u8a00)", "2024-12-07 23:07 - 2024-12-08 00:40 (11\u6761\u53d1\u8a00)", "2024-12-08 14:40 - 2024-12-09 01:25 (39\u6761\u53d1\u8a00)", "2024-12-09 10:44 - 2024-12-09 22:26 (43\u6761\u53d1\u8a00)", "2024-12-09 23:04 - 2024-12-10 00:44 (8\u6761\u53d1\u8a00)", "2024-12-10 13:00 - 2024-12-11 00:31 (54\u6761\u53d1\u8a00)", "2024-12-11 12:01 - 2024-12-11 21:56 (14\u6761\u53d1\u8a00)", "2024-12-12 15:46 - 2024-12-12 23:11 (12\u6761\u53d1\u8a00)", "2024-12-13 20:41 - 2024-12-13 23:05 (15\u6761\u53d1\u8a00)", "2024-12-14 16:03 - 2024-12-15 00:09 (24\u6761\u53d1\u8a00)", "2024-12-15 12:59 - 2024-12-16 00:48 (15\u6761\u53d1\u8a00)", "2024-12-16 10:46 - 2024-12-16 22:24 (20\u6761\u53d1\u8a00)", "2024-12-16 23:15 - 2024-12-16 22:24 (1\u6761\u53d1\u8a00)", "2024-12-17 11:33 - 2024-12-17 22:58 (51\u6761\u53d1\u8a00)", "2024-12-18 14:10 - 2024-12-19 00:41 (19\u6761\u53d1\u8a00)", "2024-12-19 13:51 - 2024-12-21 14:40 (6\u6761\u53d1\u8a00)", "2024-12-22 13:40 - 2024-12-22 22:38 (22\u6761\u53d1\u8a00)", "2024-12-23 10:40 - 2024-12-23 21:39 (21\u6761\u53d1\u8a00)", "2024-12-23 22:52 - 2024-12-23 21:39 (1\u6761\u53d1\u8a00)", "2024-12-24 12:10 - 2024-12-24 23:36 (49\u6761\u53d1\u8a00)", "2024-12-25 12:21 - 2024-12-25 22:00 (16\u6761\u53d1\u8a00)", "2024-12-26 00:33 - 2024-12-25 22:00 (1\u6761\u53d1\u8a00)", "2024-12-26 13:39 - 2024-12-26 21:17 (21\u6761\u53d1\u8a00)"]}, {"first_time": "2024-08-28 16:27:53", "last_time": "2024-10-10 15:23:37", "location": "\u56db\u5ddd", "post_count": 196, "stay_days": 2.6, "visits": ["2024-08-28 16:27 - 2024-08-29 01:13 (41\u6761\u53d1\u8a00)", "2024-08-29 12:37 - 2024-08-30 00:37 (16\u6761\u53d1\u8a00)", "2024-08-30 00:43 - 2024-08-30 10:29 (5\u6761\u53d1\u8a00)", "2024-08-30 13:13 - 2024-08-31 01:12 (48\u6761\u53d1\u8a00)", "2024-08-31 09:49 - 2024-08-31 14:14 (6\u6761\u53d1\u8a00)", "2024-10-09 14:29 - 2024-10-09 23:43 (68\u6761\u53d1\u8a00)", "2024-10-10 09:34 - 2024-10-10 15:23 (12\u6761\u53d1\u8a00)"]}, {"first_time": "2024-09-01 18:31:55", "last_time": "2024-11-09 16:26:54", "location": "\u5929\u6d25", "post_count": 63, "stay_days": 1.0, "visits": ["2024-09-01 18:31 - 2024-09-02 00:45 (14\u6761\u53d1\u8a00)", "2024-09-02 09:47 - 2024-09-02 12:19 (17\u6761\u53d1\u8a00)", "2024-10-01 13:00 - 2024-10-01 20:15 (12\u6761\u53d1\u8a00)", "2024-11-04 13:43 - 2024-11-04 18:30 (11\u6761\u53d1\u8a00)", "2024-11-07 12:33 - 2024-11-07 14:07 (5\u6761\u53d1\u8a00)", "2024-11-07 14:31 - 2024-11-07 15:08 (2\u6761\u53d1\u8a00)", "2024-11-09 15:25 - 2024-11-09 16:26 (2\u6761\u53d1\u8a00)"]}, {"first_time": "2024-09-03 11:21:41", "last_time": "2024-09-03 12:52:06", "location": "\u6c5f\u82cf", "post_count": 3, "stay_days": 0.1, "visits": ["2024-09-03 11:21 - 2024-09-03 12:52 (3\u6761\u53d1\u8a00)"]}, {"first_time": "2024-09-03 12:52:06", "last_time": "2024-12-07 23:07:12", "location": "\u6d59\u6c5f", "post_count": 390, "stay_days": 5.2, "visits": ["2024-09-03 12:52 - 2024-09-04 00:46 (63\u6761\u53d1\u8a00)", "2024-09-04 07:52 - 2024-09-04 11:40 (1\u6761\u53d1\u8a00)", "2024-10-23 13:57 - 2024-10-24 17:38 (19\u6761\u53d1\u8a00)", "2024-11-02 18:36 - 2024-11-03 06:03 (78\u6761\u53d1\u8a00)", "2024-11-03 06:54 - 2024-11-03 16:47 (27\u6761\u53d1\u8a00)", "2024-12-05 10:53 - 2024-12-05 22:37 (56\u6761\u53d1\u8a00)", "2024-12-05 23:26 - 2024-12-06 10:23 (4\u6761\u53d1\u8a00)", "2024-12-06 11:35 - 2024-12-06 23:29 (66\u6761\u53d1\u8a00)", "2024-12-06 23:50 - 2024-12-07 11:47 (26\u6761\u53d1\u8a00)", "2024-12-07 11:53 - 2024-12-07 23:07 (50\u6761\u53d1\u8a00)"]}, {"first_time": "2024-09-04 11:40:14", "last_time": "2024-11-09 15:25:53", "location": "\u5c71\u4e1c", "post_count": 145, "stay_days": 1.4, "visits": ["2024-09-04 11:40 - 2024-09-04 12:37 (7\u6761\u53d1\u8a00)", "2024-09-19 11:54 - 2024-09-19 15:53 (17\u6761\u53d1\u8a00)", "2024-11-07 14:07 - 2024-11-07 14:31 (3\u6761\u53d1\u8a00)", "2024-11-07 15:08 - 2024-11-07 23:51 (31\u6761\u53d1\u8a00)", "2024-11-08 07:47 - 2024-11-08 19:44 (61\u6761\u53d1\u8a00)", "2024-11-08 21:00 - 2024-11-08 21:59 (2\u6761\u53d1\u8a00)", "2024-11-09 09:32 - 2024-11-09 15:25 (24\u6761\u53d1\u8a00)"]}, {"first_time": "2024-09-09 19:58:35", "last_time": "2024-09-22 18:46:18", "location": "\u4e91\u5357", "post_count": 203, "stay_days": 2.7, "visits": ["2024-09-09 19:58 - 2024-09-10 00:21 (30\u6761\u53d1\u8a00)", "2024-09-10 10:47 - 2024-09-10 22:13 (56\u6761\u53d1\u8a00)", "2024-09-10 22:55 - 2024-09-11 15:35 (5\u6761\u53d1\u8a00)", "2024-09-20 11:58 - 2024-09-20 22:38 (66\u6761\u53d1\u8a00)", "2024-09-21 09:30 - 2024-09-21 19:55 (32\u6761\u53d1\u8a00)", "2024-09-21 22:08 - 2024-09-22 01:22 (12\u6761\u53d1\u8a00)", "2024-09-22 12:48 - 2024-09-22 18:46 (2\u6761\u53d1\u8a00)"]}, {"first_time": "2024-09-14 15:36:28", "last_time": "2024-09-19 11:54:22", "location": "\u5409\u6797", "post_count": 115, "stay_days": 3.2, "visits": ["2024-09-14 15:36 - 2024-09-15 00:35 (15\u6761\u53d1\u8a00)", "2024-09-15 12:15 - 2024-09-15 23:11 (8\u6761\u53d1\u8a00)", "2024-09-16 00:40 - 2024-09-16 12:39 (7\u6761\u53d1\u8a00)", "2024-09-16 12:41 - 2024-09-17 00:37 (46\u6761\u53d1\u8a00)", "2024-09-17 00:51 - 2024-09-17 00:58 (3\u6761\u53d1\u8a00)", "2024-09-17 15:24 - 2024-09-18 01:54 (21\u6761\u53d1\u8a00)", "2024-09-18 10:31 - 2024-09-18 18:11 (2\u6761\u53d1\u8a00)", "2024-09-18 22:57 - 2024-09-19 11:54 (13\u6761\u53d1\u8a00)"]}, {"first_time": "2024-09-19 15:53:49", "last_time": "2024-09-20 11:58:08", "location": "\u5b89\u5fbd", "post_count": 12, "stay_days": 0.9, "visits": ["2024-09-19 15:53 - 2024-09-20 11:58 (12\u6761\u53d1\u8a00)"]}, {"first_time": "2024-09-25 14:39:19", "last_time": "2024-09-28 11:23:12", "location": "\u9655\u897f", "post_count": 194, "stay_days": 2.3, "visits": ["2024-09-25 14:39 - 2024-09-25 23:22 (53\u6761\u53d1\u8a00)", "2024-09-26 03:11 - 2024-09-26 14:48 (20\u6761\u53d1\u8a00)", "2024-09-26 16:09 - 2024-09-27 00:46 (56\u6761\u53d1\u8a00)", "2024-09-27 08:52 - 2024-09-27 20:03 (45\u6761\u53d1\u8a00)", "2024-09-27 21:41 - 2024-09-28 11:23 (20\u6761\u53d1\u8a00)"]}, {"first_time": "2024-10-18 12:02:37", "last_time": "2024-10-19 16:48:31", "location": "\u4e0a\u6d77", "post_count": 57, "stay_days": 0.8, "visits": ["2024-10-18 12:02 - 2024-10-18 23:37 (42\u6761\u53d1\u8a00)", "2024-10-19 10:19 - 2024-10-19 16:48 (15\u6761\u53d1\u8a00)"]}, {"first_time": "2024-11-13 16:09:16", "last_time": "2024-12-22 13:40:10", "location": "\u5e7f\u4e1c", "post_count": 164, "stay_days": 2.7, "visits": ["2024-11-13 16:09 - 2024-11-14 00:26 (44\u6761\u53d1\u8a00)", "2024-11-14 14:52 - 2024-11-14 21:55 (24\u6761\u53d1\u8a00)", "2024-11-15 09:46 - 2024-11-15 19:15 (10\u6761\u53d1\u8a00)", "2024-11-15 21:47 - 2024-11-15 23:15 (4\u6761\u53d1\u8a00)", "2024-11-16 15:49 - 2024-11-16 19:37 (7\u6761\u53d1\u8a00)", "2024-11-18 07:31 - 2024-11-18 18:20 (49\u6761\u53d1\u8a00)", "2024-12-21 14:40 - 2024-12-22 13:40 (26\u6761\u53d1\u8a00)"]}, {"first_time": "2024-11-16 19:37:56", "last_time": "2024-11-18 07:31:41", "location": "\u6fb3\u95e8", "post_count": 87, "stay_days": 1.0, "visits": ["2024-11-16 19:37 - 2024-11-17 02:06 (39\u6761\u53d1\u8a00)", "2024-11-17 09:47 - 2024-11-17 17:23 (22\u6761\u53d1\u8a00)", "2024-11-17 21:51 - 2024-11-18 07:31 (26\u6761\u53d1\u8a00)"]}];
                    console.log('原始旅行数据:', travelData);
                    
                    var container = document.getElementById('travel-heatmap');
                    if (!container) {
                        console.error('找不到地图容器');
                        return;
                    }
                    
                    // 如果已存在地图实例，先销毁
                    if (mapChart) {
                        mapChart.dispose();
                        mapChart = null;
                    }
                    
                    // 加载中国地图数据
                    try {
                        const response = await fetch('./china.json');  // 使用本地文件
                        const mapData = await response.json();
                        echarts.registerMap('china', mapData);
                        console.log('地图数据加载成功');
                    } catch (error) {
                        console.error('加载地图数据失败:', error);
                        return;
                    }
                    
                    // 创建新的地图实例
                    mapChart = echarts.init(container);
                    
                    // 初始化所有省份的数据
                    var allProvinces = {
                        '北京': '北京市',
                        '天津': '天津市',
                        '河北': '河北省',
                        '山西': '山西省',
                        '内蒙古': '内蒙古自治区',
                        '辽宁': '辽宁省',
                        '吉林': '吉林省',
                        '黑龙江': '黑龙江省',
                        '上海': '上海市',
                        '江苏': '江苏省',
                        '浙江': '浙江省',
                        '安徽': '安徽省',
                        '福建': '福建省',
                        '江西': '江西省',
                        '山东': '山东省',
                        '河南': '河南省',
                        '湖北': '湖北省',
                        '湖南': '湖南省',
                        '广东': '广东省',
                        '广西': '广西壮族自治区',
                        '海南': '海南省',
                        '重庆': '重庆市',
                        '四川': '四川省',
                        '贵州': '贵州省',
                        '云南': '云南省',
                        '西藏': '西藏自治区',
                        '陕西': '陕西省',
                        '甘肃': '甘肃省',
                        '青海': '青海省',
                        '宁夏': '宁夏回族自治区',
                        '新疆': '新疆维吾尔自治区',
                        '香港': '香港特别行政区',
                        '澳门': '澳门特别行政区',
                        '台湾': '台湾省'
                    };
                    
                    var processedData = Object.keys(allProvinces).map(function(shortName) {
                        var found = travelData.find(function(item) {
                            return item.location === shortName;
                        });
                        return {
                            name: allProvinces[shortName],  // 使用完整的地区名称
                            value: found ? found.post_count : 0,
                            stayDays: found ? found.stay_days : 0,
                            firstTime: found ? found.first_time : '',
                            lastTime: found ? found.last_time : '',
                            visits: found ? found.visits : []  // 添加访问记录
                        };
                    });
                    
                    console.log('处理后的地图数据:', processedData);
                    
                    var maxValue = Math.max.apply(null, processedData.map(function(item) {
                        return item.value;
                    }));
                    
                    var otherMaxValue = Math.max.apply(null, processedData.filter(function(item) {
                        return !item.name.includes('北京');  // 修改为完整名称的匹配
                    }).map(function(item) {
                        return item.value;
                    }));
                    
                    console.log('最大发帖数:', maxValue);
                    console.log('除北京外最大发帖数:', otherMaxValue);
                    
                    var mapOption = {
                        backgroundColor: '#ffffff',
                        title: {
                            text: '旅行足迹',
                            left: 'center'
                        },
                        tooltip: {
                            trigger: 'item',
                            formatter: function(params) {
                                if (params.data && params.data.value > 0) {
                                    return `${params.name}<br/>盖楼：${params.data.value}`;
                                }
                                return params.name;
                            }
                        },
                        visualMap: {
                            show: true,
                            type: 'piecewise',
                            left: 'left',
                            top: 'bottom',
                            min: 0,
                            max: maxValue,
                            calculable: true,
                            realtime: true,
                            pieces: [
                                {min: maxValue * 0.5, label: '北京', color: '#FFD700'},  // 金色
                                {min: otherMaxValue * 0.5, max: maxValue * 0.5, label: '高活跃', color: '#3399ff'}, // 中蓝色
                                {min: otherMaxValue * 0.1, max: otherMaxValue * 0.5, label: '中活跃', color: '#99ccff'}, // 浅蓝色
                                {min: 1, max: otherMaxValue * 0.1, label: '低活跃', color: '#cce5ff'}, // 非常浅的蓝色
                                {value: 0, label: '未到访', color: '#f0f0f0'} // 灰色
                            ],
                            textStyle: {
                                color: '#333'
                            }
                        },
                        series: [{
                            name: '旅行足迹',
                            type: 'map',
                            map: 'china',
                            roam: true,
                            zoom: 1.5,
                            center: [105, 38],
                            label: {
                                show: true,
                                color: '#333'
                            },
                            itemStyle: {
                                areaColor: '#f0f0f0',
                                borderColor: '#666',
                                borderWidth: 1
                            },
                            emphasis: {
                                label: {
                                    color: '#333'
                                },
                                itemStyle: {
                                    areaColor: '#b8e1ff'
                                }
                            },
                            data: processedData.map(function(item) {
                                return {
                                    name: item.name,
                                    value: item.value,
                                    stayDays: item.stayDays,
                                    firstTime: item.firstTime,
                                    lastTime: item.lastTime,
                                    itemStyle: {
                                        areaColor: item.name.includes('北京') ? '#FFD700' :
                                                  item.value >= otherMaxValue * 0.5 ? '#0066cc' :
                                                  item.value >= otherMaxValue * 0.1 ? '#66b3ff' :
                                                  item.value > 0 ? '#cce5ff' : '#f0f0f0'
                                    }
                                };
                            })
                        }]
                    };
                    
                    console.log('地图配置:', mapOption);
                    mapChart.setOption(mapOption);
                    console.log('地图选项设置完成');
                    
                    // 处理窗口大小变化
                    window.addEventListener('resize', function() {
                        if (mapChart) {
                            console.log('窗口大小变化，重新调整地图大小');
                            mapChart.resize();
                        }
                    });
                } catch (error) {
                    console.error('设置地图选项时出错:', error);
                    console.error('错误堆栈:', error.stack);
                }
            }
        </script>
        
    </div>
</body>
</html> 
