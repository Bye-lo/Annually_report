<!DOCTYPE html>
<html>
<head>
    <title>司命的年度总结</title>
    <meta charset="utf-8">

    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .card {
            background: rgb(255, 255, 255);
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); 
            padding: 20px;
            margin: 20px 0;
            border: 1px solid #ccc;
        }
        .summary-item {
            margin: 20px 0;
        }
        .flex-container {
            display: flex;
            gap: 40px;
            margin: 20px 0;
        }
        .flex-column {
            flex: 1;
        }
        .chart-container {
            position: relative;
            height: 300px;
            width: 100%;
            margin: 20px 0;
        }
        .monthly-stats {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 10px;
            margin: 10px 0;
        }
        .month-stat {
            padding: 10px;
            border: 1px solid #ddd;
            text-align: center;
        }
        .tag {
            display: inline-block;
            padding: 4px 8px;
            margin: 4px;
            border-radius: 4px;
            background-color: #e9ecef;
            color: #495057;
        }
        .tag.active {
            background-color: #007bff;
            color: white;
        }
        .confidence {
            font-size: 0.9em;
            color: #6c757d;
        }
        .confidence.high {
            color: #28a745;
        }
        .confidence.medium {
            color: #ffc107;
        }
        .confidence.low {
            color: #dc3545;
        }
        .heatmap-container {
            display: grid;
            grid-template-columns: repeat(24, 1fr);
            gap: 2px;
            margin: 20px 0;
        }
        .heatmap-cell {
            aspect-ratio: 1;
            border-radius: 2px;
        }
        .back-button {
            display: inline-block;
            padding: 10px 20px;
            background-color: #007bff;
            border: none;
            border-radius: 4px;
            text-decoration: none;
            color: white;
            margin-bottom: 20px;
            transition: background-color 0.3s;
        }
        .back-button:hover {
            background-color: #0056b3;
        }
        .stat-card {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .stat-value {
            font-size: 1.5em;
            font-weight: bold;
            color: #007bff;
        }
        .tags-section {
            margin: 10px 0;
        }
        .tags-section h4 {
            margin: 15px 0 8px 0;
            color: #495057;
            font-size: 0.95em;
        }
        .tags-container {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            padding: 5px 0;
        }
        .tag {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 16px;
            font-size: 0.9em;
            margin: 0;
        }
        .tag.primary {
            background-color: #007bff;
            color: white;
        }
        .tag.secondary {
            background-color: #28a745;
            color: white;
        }
        .tag.special {
            background-color: #17a2b8;
            color: white;
        }
        .tag.rank {
            background-color: #ffd700;
            color: #000;
            font-weight: bold;
            font-size: 0.85em;
            padding: 2px 8px;
            margin-left: 8px;
            vertical-align: middle;
        }
    </style>
</head>
<body>
    <a href="index.html" class="back-button">返回首页</a>
    <div class="card">
        <h1>司命的年度总结</h1>
        
        <div class="card">
            <div class="flex-container">
                <div class="flex-column">
                    <div class="summary-item">
                        <h3>首次进楼时间</h3>
                        <p class="stat-value">2024年04月24日 15:58:35</p>
                    </div>
                    
                    <div class="summary-item">
                        <h3>年度盖楼总次数</h3>
                        <p class="stat-value">14520次</p>
                    </div>
                    
                    <div class="summary-item">
                        <h3>最活跃的一天</h3>
                        <p class="stat-value">2024年06月14日: 346条发言</p>
                    </div>
                </div>
                    
                <div class="flex-column">
                    <div class="summary-item">
                        <h3>活跃度分析</h3>
                        <p>活跃天数：<span class="stat-value">115</span> / 243 天
                        
                        </p>
                        
                        <div class="tags-container">
                            
                                
                                    <span class="tag primary">夜间活跃</span>
                                
                            
                                
                                    <span class="tag primary">下午活跃</span>
                                
                            
                                
                            
                                
                            
                        </div>
                        
                        <p>最长持续在线：<span class="stat-value">107</span> 天
                        
                            <span class="tag rank">Top10</span>
                        
                        </p>
                        
                            <span class="tag special">连续活跃</span>
                        
                        
                        <p>活跃时平均每天盖楼：<span class="stat-value">126.3</span> 条
                        
                            <span class="tag rank">Top1</span>
                        
                        </p>
                    </div>
                </div>
            </div>
        </div>


        <div class="card">
            <div class="flex-container">
                <div class="flex-column">
                    
                    <div class="summary-item">
                        <h3>回复最多的用户</h3>
                        <p class="stat-value">点解点解DJ</p>
                        <p>共回复1063次</p>
                    </div>
                    
                </div>
                
                <div class="flex-column">
                    
                    <div class="summary-item">
                        <h3>被回复最多的用户</h3>
                        <p class="stat-value">点解点解DJ</p>
                        <p>被回复834次</p>
                    </div>
                    
                </div>
            </div>
        </div>
    
        <div class="card">
            <h3>每日盖楼热力趋势</h3>
            <div class="chart-container">
                <canvas id="hourlyHeatmap"></canvas>
            </div>
        </div>

        <div class="card">
            <h3>添砖加瓦趋势</h3>
            <div class="chart-container">
                <canvas id="monthlyChart"></canvas>
            </div>
        </div>

        <!-- 使用 Chart.js -->
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
        
        <script type="text/javascript">
            var monthlyChart = null;
            var hourlyChart = null;
            
            // 确保DOM加载完成后初始化图表
            document.addEventListener('DOMContentLoaded', function() {
                console.log('DOM加载完成');
                initializeCharts();
            });
            
            function initializeCharts() {
                try {
                    // 月度趋势图
                    var monthlyData = [{"count": 1063, "month": "2024-04"}, {"count": 5024, "month": "2024-05"}, {"count": 5592, "month": "2024-06"}, {"count": 2605, "month": "2024-07"}, {"count": 230, "month": "2024-08"}, {"count": 4, "month": "2024-09"}, {"count": 1, "month": "2024-11"}, {"count": 1, "month": "2024-12"}];
                    var monthlyCtx = document.getElementById('monthlyChart');
                    if (monthlyCtx) {
                        // 如果已存在图表实例，先销毁
                        if (monthlyChart) {
                            monthlyChart.destroy();
                            monthlyChart = null;
                        }
                        
                        monthlyChart = new Chart(monthlyCtx.getContext('2d'), {
                            type: 'bar',
                            data: {
                                labels: monthlyData.map(function(item) { return item.month; }),
                                datasets: [{
                                    label: '盖楼数',
                                    data: monthlyData.map(function(item) { return item.count; }),
                                    backgroundColor: 'rgba(54, 162, 235, 0.5)',
                                    borderColor: 'rgba(54, 162, 235, 1)',
                                    borderWidth: 1
                                }]
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                scales: {
                                    y: {
                                        beginAtZero: true
                                    }
                                }
                            }
                        });
                    }
                    
                    // 小时分布热力图
                    var hourlyData = {"0": 1183, "1": 634, "2": 183, "3": 31, "4": 2, "5": 1, "6": 8, "7": 24, "8": 54, "9": 154, "10": 411, "11": 543, "12": 684, "13": 685, "14": 814, "15": 825, "16": 889, "17": 804, "18": 831, "19": 974, "20": 934, "21": 1078, "22": 1211, "23": 1563};
                    var hourlyCtx = document.getElementById('hourlyHeatmap');
                    if (hourlyCtx) {
                        // 如果已存在图表实例，先销毁
                        if (hourlyChart) {
                            hourlyChart.destroy();
                            hourlyChart = null;
                        }
                        
                        var hours = Array.from({length: 24}, function(_, i) { return i; });
                        var hourCounts = hours.map(function(hour) { 
                            return hourlyData[hour] || 0; 
                        });
                        
                        hourlyChart = new Chart(hourlyCtx.getContext('2d'), {
                            type: 'bar',
                            data: {
                                labels: hours.map(function(h) { return h + '时'; }),
                                datasets: [{
                                    label: '盖楼数',
                                    data: hourCounts,
                                    backgroundColor: hourCounts.map(function(count) {
                                        var maxCount = Math.max.apply(null, hourCounts);
                                        var alpha = Math.min(count / maxCount, 1);
                                        return 'rgba(54, 162, 235, ' + alpha + ')';
                                    }),
                                    borderColor: 'rgba(54, 162, 235, 1)',
                                    borderWidth: 1
                                }]
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                scales: {
                                    y: {
                                        beginAtZero: true
                                    }
                                }
                            }
                        });
                    }
                } catch (error) {
                    console.error('初始化图表时出错:', error);
                    console.error('错误堆栈:', error.stack);
                }
            }
        </script>
        
        
        <div class="card">
            <div class="card-header">
                <h5>旅行足迹</h5>
            </div>
            <div class="card-body">
                <div id="travel-heatmap" style="width: 100%; height: 600px; margin: 20px 0;"></div>
            </div>
        </div>
        
        <!-- 使用 ECharts -->
        <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
        
        <script type="text/javascript">
            var mapChart = null;
            
            document.addEventListener('DOMContentLoaded', async function() {
                await initializeMap();
            });
            
            async function initializeMap() {
                try {
                    // 初始化旅行热力图
                    var travelData = [{"first_time": "2024-04-24 15:58:35", "last_time": "2024-07-19 09:16:24", "location": "\u5317\u4eac", "post_count": 12217, "stay_days": -57.3, "visits": ["2024-04-24 15:58 - 2024-04-25 00:33 (101\u6761\u53d1\u8a00)", "2024-04-25 08:37 - 2024-04-25 20:18 (68\u6761\u53d1\u8a00)", "2024-04-25 20:40 - 2024-04-26 01:26 (83\u6761\u53d1\u8a00)", "2024-04-26 09:08 - 2024-04-26 20:29 (133\u6761\u53d1\u8a00)", "2024-04-26 21:12 - 2024-04-27 02:46 (91\u6761\u53d1\u8a00)", "2024-04-27 10:09 - 2024-04-27 22:05 (185\u6761\u53d1\u8a00)", "2024-04-27 22:10 - 2024-04-28 02:00 (72\u6761\u53d1\u8a00)", "2024-04-28 10:59 - 2024-04-28 22:57 (86\u6761\u53d1\u8a00)", "2024-04-28 22:59 - 2024-04-29 10:41 (54\u6761\u53d1\u8a00)", "2024-04-29 11:16 - 2024-04-29 16:10 (41\u6761\u53d1\u8a00)", "2024-05-03 12:52 - 2024-05-04 00:49 (159\u6761\u53d1\u8a00)", "2024-05-04 00:57 - 2024-05-04 12:55 (39\u6761\u53d1\u8a00)", "2024-05-04 13:03 - 2024-05-05 00:59 (131\u6761\u53d1\u8a00)", "2024-05-05 01:18 - 2024-05-05 13:18 (60\u6761\u53d1\u8a00)", "2024-05-05 13:21 - 2024-05-06 01:18 (212\u6761\u53d1\u8a00)", "2024-05-06 01:21 - 2024-05-06 13:15 (66\u6761\u53d1\u8a00)", "2024-05-06 13:31 - 2024-05-07 00:41 (241\u6761\u53d1\u8a00)", "2024-05-07 01:41 - 2024-05-07 13:41 (26\u6761\u53d1\u8a00)", "2024-05-07 14:27 - 2024-05-08 01:39 (168\u6761\u53d1\u8a00)", "2024-05-08 11:37 - 2024-05-08 23:36 (50\u6761\u53d1\u8a00)", "2024-05-08 23:38 - 2024-05-09 02:20 (36\u6761\u53d1\u8a00)", "2024-05-09 12:57 - 2024-05-10 00:56 (81\u6761\u53d1\u8a00)", "2024-05-10 01:01 - 2024-05-10 12:52 (52\u6761\u53d1\u8a00)", "2024-05-10 13:03 - 2024-05-11 00:51 (103\u6761\u53d1\u8a00)", "2024-05-11 01:09 - 2024-05-11 13:07 (13\u6761\u53d1\u8a00)", "2024-05-11 13:09 - 2024-05-12 00:35 (96\u6761\u53d1\u8a00)", "2024-05-12 09:49 - 2024-05-12 21:43 (64\u6761\u53d1\u8a00)", "2024-05-12 21:51 - 2024-05-13 09:44 (47\u6761\u53d1\u8a00)", "2024-05-13 09:53 - 2024-05-13 21:52 (117\u6761\u53d1\u8a00)", "2024-05-13 21:56 - 2024-05-14 02:12 (70\u6761\u53d1\u8a00)", "2024-05-14 11:16 - 2024-05-14 23:14 (100\u6761\u53d1\u8a00)", "2024-05-14 23:20 - 2024-05-15 10:12 (58\u6761\u53d1\u8a00)", "2024-05-15 11:42 - 2024-05-15 14:14 (9\u6761\u53d1\u8a00)", "2024-05-17 10:19 - 2024-05-17 22:18 (116\u6761\u53d1\u8a00)", "2024-05-17 22:27 - 2024-05-18 01:35 (33\u6761\u53d1\u8a00)", "2024-05-18 10:58 - 2024-05-18 17:38 (10\u6761\u53d1\u8a00)", "2024-05-19 17:47 - 2024-05-20 01:37 (113\u6761\u53d1\u8a00)", "2024-05-20 10:00 - 2024-05-20 21:48 (167\u6761\u53d1\u8a00)", "2024-05-20 22:00 - 2024-05-20 23:53 (27\u6761\u53d1\u8a00)", "2024-05-21 12:02 - 2024-05-22 00:02 (227\u6761\u53d1\u8a00)", "2024-05-22 00:03 - 2024-05-22 11:39 (32\u6761\u53d1\u8a00)", "2024-05-22 13:57 - 2024-05-23 01:49 (160\u6761\u53d1\u8a00)", "2024-05-23 11:18 - 2024-05-23 23:18 (290\u6761\u53d1\u8a00)", "2024-05-23 23:21 - 2024-05-24 10:57 (54\u6761\u53d1\u8a00)", "2024-05-24 12:00 - 2024-05-25 00:00 (98\u6761\u53d1\u8a00)", "2024-05-25 00:02 - 2024-05-25 01:37 (33\u6761\u53d1\u8a00)", "2024-05-25 13:15 - 2024-05-26 01:14 (134\u6761\u53d1\u8a00)", "2024-05-26 01:15 - 2024-05-26 12:45 (2\u6761\u53d1\u8a00)", "2024-05-26 13:55 - 2024-05-27 01:25 (86\u6761\u53d1\u8a00)", "2024-05-27 08:50 - 2024-05-27 20:06 (103\u6761\u53d1\u8a00)", "2024-05-27 20:51 - 2024-05-27 23:52 (45\u6761\u53d1\u8a00)", "2024-05-28 12:16 - 2024-05-29 00:12 (168\u6761\u53d1\u8a00)", "2024-05-29 00:29 - 2024-05-29 12:21 (22\u6761\u53d1\u8a00)", "2024-05-29 12:34 - 2024-05-30 00:23 (104\u6761\u53d1\u8a00)", "2024-05-30 00:34 - 2024-05-30 12:30 (23\u6761\u53d1\u8a00)", "2024-05-30 14:23 - 2024-05-31 01:21 (69\u6761\u53d1\u8a00)", "2024-05-31 08:56 - 2024-05-31 20:27 (108\u6761\u53d1\u8a00)", "2024-05-31 21:03 - 2024-06-01 01:04 (66\u6761\u53d1\u8a00)", "2024-06-01 11:04 - 2024-06-01 19:09 (35\u6761\u53d1\u8a00)", "2024-06-02 00:13 - 2024-06-02 11:54 (37\u6761\u53d1\u8a00)", "2024-06-02 12:17 - 2024-06-03 00:04 (159\u6761\u53d1\u8a00)", "2024-06-03 00:25 - 2024-06-03 12:16 (65\u6761\u53d1\u8a00)", "2024-06-03 13:13 - 2024-06-04 01:12 (100\u6761\u53d1\u8a00)", "2024-06-04 01:14 - 2024-06-04 13:14 (29\u6761\u53d1\u8a00)", "2024-06-04 13:39 - 2024-06-04 23:42 (142\u6761\u53d1\u8a00)", "2024-06-05 12:27 - 2024-06-06 00:27 (164\u6761\u53d1\u8a00)", "2024-06-06 00:34 - 2024-06-06 11:52 (34\u6761\u53d1\u8a00)", "2024-06-06 14:30 - 2024-06-07 00:29 (179\u6761\u53d1\u8a00)", "2024-06-07 11:08 - 2024-06-07 23:02 (116\u6761\u53d1\u8a00)", "2024-06-07 23:14 - 2024-06-08 03:28 (61\u6761\u53d1\u8a00)", "2024-06-08 11:53 - 2024-06-08 23:52 (143\u6761\u53d1\u8a00)", "2024-06-08 23:55 - 2024-06-09 01:45 (44\u6761\u53d1\u8a00)", "2024-06-09 12:15 - 2024-06-10 00:13 (203\u6761\u53d1\u8a00)", "2024-06-10 00:16 - 2024-06-10 12:10 (92\u6761\u53d1\u8a00)", "2024-06-10 12:16 - 2024-06-11 00:15 (142\u6761\u53d1\u8a00)", "2024-06-11 00:23 - 2024-06-11 11:39 (28\u6761\u53d1\u8a00)", "2024-06-11 14:33 - 2024-06-12 01:49 (146\u6761\u53d1\u8a00)", "2024-06-12 11:26 - 2024-06-12 23:22 (104\u6761\u53d1\u8a00)", "2024-06-12 23:27 - 2024-06-13 11:21 (78\u6761\u53d1\u8a00)", "2024-06-13 11:30 - 2024-06-13 23:19 (203\u6761\u53d1\u8a00)", "2024-06-13 23:30 - 2024-06-14 12:15 (70\u6761\u53d1\u8a00)", "2024-06-15 14:12 - 2024-06-16 02:11 (182\u6761\u53d1\u8a00)", "2024-06-16 02:14 - 2024-06-16 14:10 (14\u6761\u53d1\u8a00)", "2024-06-16 14:15 - 2024-06-17 02:00 (138\u6761\u53d1\u8a00)", "2024-06-17 03:17 - 2024-06-17 15:03 (38\u6761\u53d1\u8a00)", "2024-06-17 15:21 - 2024-06-18 00:43 (138\u6761\u53d1\u8a00)", "2024-06-18 11:20 - 2024-06-18 23:16 (131\u6761\u53d1\u8a00)", "2024-06-18 23:22 - 2024-06-19 11:21 (26\u6761\u53d1\u8a00)", "2024-06-19 11:25 - 2024-06-19 23:18 (72\u6761\u53d1\u8a00)", "2024-06-19 23:26 - 2024-06-20 11:26 (23\u6761\u53d1\u8a00)", "2024-06-20 11:28 - 2024-06-20 23:28 (141\u6761\u53d1\u8a00)", "2024-06-20 23:38 - 2024-06-21 11:33 (35\u6761\u53d1\u8a00)", "2024-06-21 11:51 - 2024-06-21 23:49 (181\u6761\u53d1\u8a00)", "2024-06-21 23:51 - 2024-06-22 11:15 (53\u6761\u53d1\u8a00)", "2024-06-22 13:37 - 2024-06-23 01:32 (199\u6761\u53d1\u8a00)", "2024-06-23 01:43 - 2024-06-23 13:37 (44\u6761\u53d1\u8a00)", "2024-06-23 13:53 - 2024-06-24 01:52 (179\u6761\u53d1\u8a00)", "2024-06-24 01:56 - 2024-06-24 13:50 (36\u6761\u53d1\u8a00)", "2024-06-24 14:02 - 2024-06-25 01:46 (231\u6761\u53d1\u8a00)", "2024-06-25 02:02 - 2024-06-25 14:01 (40\u6761\u53d1\u8a00)", "2024-06-25 14:16 - 2024-06-26 01:34 (114\u6761\u53d1\u8a00)", "2024-06-26 11:53 - 2024-06-26 23:52 (186\u6761\u53d1\u8a00)", "2024-06-26 23:57 - 2024-06-27 11:36 (32\u6761\u53d1\u8a00)", "2024-06-27 12:08 - 2024-06-28 00:08 (105\u6761\u53d1\u8a00)", "2024-06-28 00:16 - 2024-06-28 11:41 (17\u6761\u53d1\u8a00)", "2024-06-28 12:38 - 2024-06-29 00:33 (178\u6761\u53d1\u8a00)", "2024-06-29 00:48 - 2024-06-29 10:43 (16\u6761\u53d1\u8a00)", "2024-06-29 13:10 - 2024-06-30 00:58 (75\u6761\u53d1\u8a00)", "2024-06-30 01:14 - 2024-06-30 09:37 (36\u6761\u53d1\u8a00)", "2024-06-30 13:37 - 2024-07-01 01:28 (118\u6761\u53d1\u8a00)", "2024-07-01 01:41 - 2024-07-01 13:24 (56\u6761\u53d1\u8a00)", "2024-07-01 13:55 - 2024-07-02 00:49 (102\u6761\u53d1\u8a00)", "2024-07-02 09:23 - 2024-07-02 21:16 (119\u6761\u53d1\u8a00)", "2024-07-02 21:24 - 2024-07-03 03:10 (65\u6761\u53d1\u8a00)", "2024-07-03 10:48 - 2024-07-03 21:25 (66\u6761\u53d1\u8a00)", "2024-07-03 23:15 - 2024-07-04 01:12 (28\u6761\u53d1\u8a00)", "2024-07-04 11:56 - 2024-07-04 23:47 (144\u6761\u53d1\u8a00)", "2024-07-04 23:58 - 2024-07-05 11:34 (33\u6761\u53d1\u8a00)", "2024-07-05 11:59 - 2024-07-05 23:53 (138\u6761\u53d1\u8a00)", "2024-07-06 00:01 - 2024-07-06 11:53 (50\u6761\u53d1\u8a00)", "2024-07-06 12:25 - 2024-07-06 15:23 (10\u6761\u53d1\u8a00)", "2024-07-08 15:03 - 2024-07-09 00:02 (65\u6761\u53d1\u8a00)", "2024-07-09 09:28 - 2024-07-09 14:54 (55\u6761\u53d1\u8a00)", "2024-07-10 17:06 - 2024-07-11 02:27 (72\u6761\u53d1\u8a00)", "2024-07-11 10:05 - 2024-07-11 21:59 (66\u6761\u53d1\u8a00)", "2024-07-11 22:09 - 2024-07-12 08:06 (18\u6761\u53d1\u8a00)", "2024-07-12 10:10 - 2024-07-12 22:03 (51\u6761\u53d1\u8a00)", "2024-07-12 22:16 - 2024-07-13 01:03 (22\u6761\u53d1\u8a00)", "2024-07-13 11:36 - 2024-07-13 21:37 (10\u6761\u53d1\u8a00)", "2024-07-14 00:17 - 2024-07-14 01:16 (7\u6761\u53d1\u8a00)", "2024-07-14 14:40 - 2024-07-14 18:56 (4\u6761\u53d1\u8a00)", "2024-07-15 00:31 - 2024-07-15 11:24 (27\u6761\u53d1\u8a00)", "2024-07-15 13:23 - 2024-07-15 23:26 (49\u6761\u53d1\u8a00)", "2024-07-16 13:05 - 2024-07-17 00:42 (58\u6761\u53d1\u8a00)", "2024-07-17 06:04 - 2024-07-17 10:38 (4\u6761\u53d1\u8a00)", "2024-07-18 11:44 - 2024-07-18 22:47 (61\u6761\u53d1\u8a00)", "2024-07-19 01:15 - 2024-07-19 09:16 (17\u6761\u53d1\u8a00)", "2024-07-27 23:44 - 2024-07-28 01:33 (8\u6761\u53d1\u8a00)", "2024-07-28 13:20 - 2024-07-29 00:35 (44\u6761\u53d1\u8a00)", "2024-07-29 09:31 - 2024-07-29 21:27 (54\u6761\u53d1\u8a00)", "2024-07-29 21:31 - 2024-07-30 00:11 (30\u6761\u53d1\u8a00)", "2024-07-30 11:54 - 2024-07-30 23:44 (46\u6761\u53d1\u8a00)", "2024-07-30 23:56 - 2024-07-31 11:53 (29\u6761\u53d1\u8a00)", "2024-07-31 11:58 - 2024-07-31 19:42 (19\u6761\u53d1\u8a00)", "2024-08-01 11:11 - 2024-08-01 23:07 (12\u6761\u53d1\u8a00)", "2024-08-01 23:16 - 2024-08-02 10:52 (32\u6761\u53d1\u8a00)", "2024-08-02 12:13 - 2024-08-02 23:55 (34\u6761\u53d1\u8a00)", "2024-08-03 03:40 - 2024-08-03 14:01 (3\u6761\u53d1\u8a00)", "2024-08-03 16:49 - 2024-08-04 01:46 (19\u6761\u53d1\u8a00)", "2024-08-04 15:22 - 2024-08-05 02:26 (26\u6761\u53d1\u8a00)", "2024-08-05 04:28 - 2024-08-05 16:24 (25\u6761\u53d1\u8a00)", "2024-08-05 16:40 - 2024-08-06 00:29 (14\u6761\u53d1\u8a00)", "2024-08-06 16:28 - 2024-08-07 01:11 (19\u6761\u53d1\u8a00)", "2024-08-07 10:57 - 2024-08-07 21:29 (35\u6761\u53d1\u8a00)", "2024-08-07 23:48 - 2024-08-08 02:50 (3\u6761\u53d1\u8a00)", "2024-08-20 10:44 - 2024-08-20 21:24 (6\u6761\u53d1\u8a00)", "2024-08-22 13:34 - 2024-08-20 21:24 (1\u6761\u53d1\u8a00)", "2024-08-26 16:29 - 2024-08-20 21:24 (1\u6761\u53d1\u8a00)", "2024-09-06 23:38 - 2024-08-20 21:24 (1\u6761\u53d1\u8a00)", "2024-09-08 21:55 - 2024-09-08 22:52 (2\u6761\u53d1\u8a00)", "2024-09-29 23:51 - 2024-09-08 22:52 (1\u6761\u53d1\u8a00)", "2024-11-24 22:41 - 2024-09-08 22:52 (1\u6761\u53d1\u8a00)", "2024-12-22 22:35 - 2024-12-22 22:35 (1\u6761\u53d1\u8a00)"]}, {"first_time": "2024-04-29 16:10:23", "last_time": "2024-04-29 16:27:54", "location": "\u8fbd\u5b81", "post_count": 6, "stay_days": 0.1, "visits": ["2024-04-29 16:10 - 2024-04-29 16:27 (6\u6761\u53d1\u8a00)"]}, {"first_time": "2024-04-29 16:27:54", "last_time": "2024-07-10 17:06:47", "location": "\u5409\u6797", "post_count": 498, "stay_days": 3.9, "visits": ["2024-04-29 16:27 - 2024-04-30 01:52 (74\u6761\u53d1\u8a00)", "2024-04-30 09:43 - 2024-04-30 21:20 (63\u6761\u53d1\u8a00)", "2024-04-30 23:04 - 2024-05-01 02:17 (27\u6761\u53d1\u8a00)", "2024-05-01 12:23 - 2024-05-02 00:23 (48\u6761\u53d1\u8a00)", "2024-05-02 00:24 - 2024-05-02 12:19 (20\u6761\u53d1\u8a00)", "2024-05-02 12:43 - 2024-05-03 00:42 (110\u6761\u53d1\u8a00)", "2024-05-03 00:44 - 2024-05-03 12:52 (24\u6761\u53d1\u8a00)", "2024-07-09 14:54 - 2024-07-10 00:30 (120\u6761\u53d1\u8a00)", "2024-07-10 07:03 - 2024-07-10 17:06 (12\u6761\u53d1\u8a00)"]}, {"first_time": "2024-05-15 14:14:35", "last_time": "2024-07-27 19:30:41", "location": "\u4e0a\u6d77", "post_count": 274, "stay_days": 1.5, "visits": ["2024-05-15 14:14 - 2024-05-16 02:05 (201\u6761\u53d1\u8a00)", "2024-05-16 09:55 - 2024-05-16 14:25 (16\u6761\u53d1\u8a00)", "2024-07-26 14:32 - 2024-07-27 01:45 (37\u6761\u53d1\u8a00)", "2024-07-27 12:09 - 2024-07-27 19:30 (20\u6761\u53d1\u8a00)"]}, {"first_time": "2024-05-16 14:25:27", "last_time": "2024-07-23 16:53:09", "location": "\u6d59\u6c5f", "post_count": 494, "stay_days": 3.1, "visits": ["2024-05-16 14:25 - 2024-05-17 02:21 (201\u6761\u53d1\u8a00)", "2024-05-17 07:04 - 2024-05-17 10:19 (6\u6761\u53d1\u8a00)", "2024-07-19 14:43 - 2024-07-20 02:23 (53\u6761\u53d1\u8a00)", "2024-07-20 11:04 - 2024-07-20 23:04 (92\u6761\u53d1\u8a00)", "2024-07-20 23:04 - 2024-07-21 02:09 (25\u6761\u53d1\u8a00)", "2024-07-21 11:06 - 2024-07-21 22:34 (58\u6761\u53d1\u8a00)", "2024-07-21 23:18 - 2024-07-22 02:11 (10\u6761\u53d1\u8a00)", "2024-07-22 12:27 - 2024-07-22 23:47 (42\u6761\u53d1\u8a00)", "2024-07-23 12:13 - 2024-07-23 16:53 (7\u6761\u53d1\u8a00)"]}, {"first_time": "2024-05-18 17:38:17", "last_time": "2024-07-19 09:59:00", "location": "\u6cb3\u5317", "post_count": 296, "stay_days": 1.9, "visits": ["2024-05-18 17:38 - 2024-05-19 00:42 (80\u6761\u53d1\u8a00)", "2024-05-19 05:44 - 2024-05-19 17:47 (20\u6761\u53d1\u8a00)", "2024-07-06 20:04 - 2024-07-07 01:13 (53\u6761\u53d1\u8a00)", "2024-07-07 08:31 - 2024-07-07 19:59 (82\u6761\u53d1\u8a00)", "2024-07-07 21:27 - 2024-07-08 01:38 (48\u6761\u53d1\u8a00)", "2024-07-08 10:17 - 2024-07-08 13:34 (12\u6761\u53d1\u8a00)", "2024-07-19 09:41 - 2024-07-19 09:59 (1\u6761\u53d1\u8a00)"]}, {"first_time": "2024-06-01 19:09:51", "last_time": "2024-07-27 23:44:42", "location": "\u5929\u6d25", "post_count": 76, "stay_days": 0.8, "visits": ["2024-06-01 19:09 - 2024-06-02 00:13 (34\u6761\u53d1\u8a00)", "2024-07-06 15:23 - 2024-07-06 20:04 (14\u6761\u53d1\u8a00)", "2024-07-08 13:34 - 2024-07-08 15:03 (6\u6761\u53d1\u8a00)", "2024-07-14 18:56 - 2024-07-15 00:31 (14\u6761\u53d1\u8a00)", "2024-07-19 09:16 - 2024-07-19 09:41 (1\u6761\u53d1\u8a00)", "2024-07-27 22:51 - 2024-07-27 23:44 (7\u6761\u53d1\u8a00)"]}, {"first_time": "2024-06-14 12:15:59", "last_time": "2024-06-15 14:12:27", "location": "\u56db\u5ddd", "post_count": 408, "stay_days": 1.1, "visits": ["2024-06-14 12:15 - 2024-06-15 00:11 (293\u6761\u53d1\u8a00)", "2024-06-15 00:16 - 2024-06-15 14:12 (115\u6761\u53d1\u8a00)"]}, {"first_time": "2024-07-17 10:38:33", "last_time": "2024-07-24 09:53:54", "location": "\u5b89\u5fbd", "post_count": 98, "stay_days": 1.8, "visits": ["2024-07-17 10:38 - 2024-07-17 21:48 (27\u6761\u53d1\u8a00)", "2024-07-17 23:05 - 2024-07-18 11:44 (16\u6761\u53d1\u8a00)", "2024-07-23 16:53 - 2024-07-24 09:53 (55\u6761\u53d1\u8a00)"]}, {"first_time": "2024-07-19 09:59:00", "last_time": "2024-07-27 22:51:29", "location": "\u5c71\u4e1c", "post_count": 18, "stay_days": 0.2, "visits": ["2024-07-19 09:59 - 2024-07-19 13:26 (5\u6761\u53d1\u8a00)", "2024-07-27 21:43 - 2024-07-27 22:51 (13\u6761\u53d1\u8a00)"]}, {"first_time": "2024-07-19 13:26:00", "last_time": "2024-07-27 21:43:39", "location": "\u6c5f\u82cf", "post_count": 30, "stay_days": 0.2, "visits": ["2024-07-19 13:26 - 2024-07-19 14:43 (13\u6761\u53d1\u8a00)", "2024-07-27 19:30 - 2024-07-27 21:43 (17\u6761\u53d1\u8a00)"]}, {"first_time": "2024-07-24 09:53:54", "last_time": "2024-07-26 14:32:30", "location": "\u6c5f\u897f", "post_count": 99, "stay_days": 1.7, "visits": ["2024-07-24 09:53 - 2024-07-24 21:51 (41\u6761\u53d1\u8a00)", "2024-07-24 22:05 - 2024-07-25 00:42 (14\u6761\u53d1\u8a00)", "2024-07-25 12:55 - 2024-07-26 00:00 (41\u6761\u53d1\u8a00)", "2024-07-26 01:13 - 2024-07-26 14:32 (3\u6761\u53d1\u8a00)"]}];
                    console.log('原始旅行数据:', travelData);
                    
                    var container = document.getElementById('travel-heatmap');
                    if (!container) {
                        console.error('找不到地图容器');
                        return;
                    }
                    
                    // 如果已存在地图实例，先销毁
                    if (mapChart) {
                        mapChart.dispose();
                        mapChart = null;
                    }
                    
                    // 加载中国地图数据
                    try {
                        const response = await fetch('./china.json');  // 使用本地文件
                        const mapData = await response.json();
                        echarts.registerMap('china', mapData);
                        console.log('地图数据加载成功');
                    } catch (error) {
                        console.error('加载地图数据失败:', error);
                        return;
                    }
                    
                    // 创建新的地图实例
                    mapChart = echarts.init(container);
                    
                    // 初始化所有省份的数据
                    var allProvinces = {
                        '北京': '北京市',
                        '天津': '天津市',
                        '河北': '河北省',
                        '山西': '山西省',
                        '内蒙古': '内蒙古自治区',
                        '辽宁': '辽宁省',
                        '吉林': '吉林省',
                        '黑龙江': '黑龙江省',
                        '上海': '上海市',
                        '江苏': '江苏省',
                        '浙江': '浙江省',
                        '安徽': '安徽省',
                        '福建': '福建省',
                        '江西': '江西省',
                        '山东': '山东省',
                        '河南': '河南省',
                        '湖北': '湖北省',
                        '湖南': '湖南省',
                        '广东': '广东省',
                        '广西': '广西壮族自治区',
                        '海南': '海南省',
                        '重庆': '重庆市',
                        '四川': '四川省',
                        '贵州': '贵州省',
                        '云南': '云南省',
                        '西藏': '西藏自治区',
                        '陕西': '陕西省',
                        '甘肃': '甘肃省',
                        '青海': '青海省',
                        '宁夏': '宁夏回族自治区',
                        '新疆': '新疆维吾尔自治区',
                        '香港': '香港特别行政区',
                        '澳门': '澳门特别行政区',
                        '台湾': '台湾省'
                    };
                    
                    var processedData = Object.keys(allProvinces).map(function(shortName) {
                        var found = travelData.find(function(item) {
                            return item.location === shortName;
                        });
                        return {
                            name: allProvinces[shortName],  // 使用完整的地区名称
                            value: found ? found.post_count : 0,
                            stayDays: found ? found.stay_days : 0,
                            firstTime: found ? found.first_time : '',
                            lastTime: found ? found.last_time : '',
                            visits: found ? found.visits : []  // 添加访问记录
                        };
                    });
                    
                    console.log('处理后的地图数据:', processedData);
                    
                    var maxValue = Math.max.apply(null, processedData.map(function(item) {
                        return item.value;
                    }));
                    
                    var otherMaxValue = Math.max.apply(null, processedData.filter(function(item) {
                        return !item.name.includes('北京');  // 修改为完整名称的匹配
                    }).map(function(item) {
                        return item.value;
                    }));
                    
                    console.log('最大发帖数:', maxValue);
                    console.log('除北京外最大发帖数:', otherMaxValue);
                    
                    var mapOption = {
                        backgroundColor: '#ffffff',
                        title: {
                            text: '旅行足迹',
                            left: 'center'
                        },
                        tooltip: {
                            trigger: 'item',
                            formatter: function(params) {
                                if (params.data && params.data.value > 0) {
                                    return `${params.name}<br/>盖楼：${params.data.value}`;
                                }
                                return params.name;
                            }
                        },
                        visualMap: {
                            show: true,
                            type: 'piecewise',
                            left: 'left',
                            top: 'bottom',
                            min: 0,
                            max: maxValue,
                            calculable: true,
                            realtime: true,
                            pieces: [
                                {min: maxValue * 0.5, label: '北京', color: '#FFD700'},  // 金色
                                {min: otherMaxValue * 0.5, max: maxValue * 0.5, label: '高活跃', color: '#3399ff'}, // 中蓝色
                                {min: otherMaxValue * 0.1, max: otherMaxValue * 0.5, label: '中活跃', color: '#99ccff'}, // 浅蓝色
                                {min: 1, max: otherMaxValue * 0.1, label: '低活跃', color: '#cce5ff'}, // 非常浅的蓝色
                                {value: 0, label: '未到访', color: '#f0f0f0'} // 灰色
                            ],
                            textStyle: {
                                color: '#333'
                            }
                        },
                        series: [{
                            name: '旅行足迹',
                            type: 'map',
                            map: 'china',
                            roam: true,
                            zoom: 1.5,
                            center: [105, 38],
                            label: {
                                show: true,
                                color: '#333'
                            },
                            itemStyle: {
                                areaColor: '#f0f0f0',
                                borderColor: '#666',
                                borderWidth: 1
                            },
                            emphasis: {
                                label: {
                                    color: '#333'
                                },
                                itemStyle: {
                                    areaColor: '#b8e1ff'
                                }
                            },
                            data: processedData.map(function(item) {
                                return {
                                    name: item.name,
                                    value: item.value,
                                    stayDays: item.stayDays,
                                    firstTime: item.firstTime,
                                    lastTime: item.lastTime,
                                    itemStyle: {
                                        areaColor: item.name.includes('北京') ? '#FFD700' :
                                                  item.value >= otherMaxValue * 0.5 ? '#0066cc' :
                                                  item.value >= otherMaxValue * 0.1 ? '#66b3ff' :
                                                  item.value > 0 ? '#cce5ff' : '#f0f0f0'
                                    }
                                };
                            })
                        }]
                    };
                    
                    console.log('地图配置:', mapOption);
                    mapChart.setOption(mapOption);
                    console.log('地图选项设置完成');
                    
                    // 处理窗口大小变化
                    window.addEventListener('resize', function() {
                        if (mapChart) {
                            console.log('窗口大小变化，重新调整地图大小');
                            mapChart.resize();
                        }
                    });
                } catch (error) {
                    console.error('设置地图选项时出错:', error);
                    console.error('错误堆栈:', error.stack);
                }
            }
        </script>
        
    </div>
</body>
</html> 
